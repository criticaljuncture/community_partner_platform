<div class="program-count-container">
  <dl>
    <dt>All Organizations</dt>
    <dd>
      <%= Organization.count %>
      (<%= pluralize(Organization.with_community_programs.size, 'programs') %>)
    </dd>

    <dt>OUSD Organizations</dt>
    <dd>
      <%= Organization.ousd.count %>
      (<%= pluralize(Organization.ousd.with_community_programs.size, 'programs') %>)
    </dd>

    <dt>Non-OUSD Organizations</dt>
    <dd>
      <%= Organization.non_ousd.count %>
      (<%= pluralize(Organization.non_ousd.with_community_programs.size, 'programs') %>)
    </dd>
  </dl>
</div>

<div class="table_wrapper">
  <table class="table table-striped table-hover table-sorter admin-table organization-status">
    <thead>
      <tr>
        <th class="organizations">Organization</th>
        <th class="last-updated">Most Recent User Logged In</th>
        <th class="last-verfied">Verfied</th>
        <th class="orientation-attended">Orientation Attended?</th>
        <th class="program-count">Program Count</th>
        <th class="with-progress-bar">Organization Data Completion</th>
        <th class="with-progress-bar">Average Program Data Completion</th>
        <th class="public-status">Public</th>
      </tr>
    </thead>

    <tbody>
      <% organizations.each do |organization| %>
        <tr>
          <td>
            <%= link_to organization.name, organization_path(organization) %>
          </td>
          <td>
            <%= organization.last_sign_in %>
          </td>
          <td class="text-center">
            <%= boolean_checkmark_gicon(
              !organization.verification_required?,
              {data: {tooltip: last_verified_tooltip(organization)}}
            ) %>
          </td>
          <td class="text-center">
            <%= boolean_checkmark_gicon(
              organization.any_users_attended_orientation?,
              {data: {tooltip: organization.last_orientation_attended_tooltip}}
            ) %>
          </td>
          <td class="text-center">
            <%= organization.community_programs.size %>
          </td>
          <td>
            <%= ProgressBarPresenter.perform(
              percentage: organization.completion_rate,
              options: {
                verification_required: organization.verification_required?,
                tooltip: organization.completion_rate_tooltip,
                tooltip_class: 'cj-org-progress-tooltip'
              }
            ) %>
          </td>
          <td>
            <% if organization.community_programs.present? %>
              <%= ProgressBarPresenter.perform(
                percentage: organization.average_program_completion_rate,
                options: {
                  verification_required: organization.unverified_program_count > 0
                }
              ) %>
            <% else %>
              NA
            <% end %>
          </td>
          <td class="text-center">
            <% if organization.approved_for_public? %>
              <%= link_to t('admin.make_private'),
                publish_organization_path(organization, publish: 0),
                method: :post,
                class: 'btn btn-small btn-warning' %>
            <% elsif organization.public_policy.can_be_made_public? %>
              <%= link_to t('admin.approve_for_public'),
                publish_organization_path(organization, publish: 1),
                method: :post,
                class: 'btn btn-small btn-action' %>
            <% else %>
              <%= boolean_checkmark_gicon(false,
                class: 'cj-public-policy-missing-requirements-tooltip',
                custom_tooltip: true,
                data: {
                  tooltip: missing_requirements_tooltip(organization),
                  tooltip_class: 'public-policy-missing-requirements-tooltip'
                }
              ) %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
